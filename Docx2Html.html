<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word转HTML转换器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-zone:hover {
            border-color: #764ba2;
            background: #f0f2ff;
            transform: translateY(-2px);
        }

        .upload-zone.dragover {
            border-color: #764ba2;
            background: #e8ebff;
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #667eea;
        }

        .upload-zone h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .upload-zone p {
            color: #666;
            font-size: 14px;
        }

        #fileInput {
            display: none;
        }

        .options-panel {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 25px;
        }

        .option-group {
            margin-bottom: 20px;
        }

        .option-group:last-child {
            margin-bottom: 0;
        }

        .option-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .option-group select,
        .option-group input[type="text"] {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .option-group select:focus,
        .option-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .option-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 13px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: #f8f9ff;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            color: #333;
            font-weight: 500;
        }

        .file-status {
            color: #667eea;
            font-size: 14px;
        }

        .file-status.success {
            color: #10b981;
        }

        .file-status.error {
            color: #ef4444;
        }

        .convert-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
        }

        .convert-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .convert-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .info-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .info-box h4 {
            color: #92400e;
            margin-bottom: 8px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #92400e;
        }

        .info-box li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📄 Word转HTML转换器</h1>
            <p>批量转换Word文档为HTML，支持图片标题和自定义模板</p>
        </div>

        <div class="content">
            <div class="section">
                <div class="section-title">1. 上传文件</div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">📁</div>
                    <h3>点击或拖拽文件到这里</h3>
                    <p>支持批量上传多个.docx文件</p>
                </div>
                <input type="file" id="fileInput" accept=".docx" multiple>
                <div class="file-list" id="fileList"></div>
            </div>

            <div class="section">
                <div class="section-title">2. 转换选项</div>
                <div class="options-panel">
                    <div class="option-group">
                        <label>输出格式</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="outputFormat" value="complete" checked>
                                完整HTML文件
                            </label>
                            <label>
                                <input type="radio" name="outputFormat" value="fragment">
                                仅HTML片段（用于插入模板）
                            </label>
                        </div>
                        <small>选择"仅HTML片段"将只输出内容部分，方便插入到您的模板中</small>
                    </div>

                    <div class="option-group">
                        <label for="imgCaptionClass">图片标题CSS类名</label>
                        <input type="text" id="imgCaptionClass" value="img-caption" placeholder="例如: img-caption">
                        <small>生成的图片标题将使用此CSS类名，便于在模板中统一样式</small>
                    </div>

                    <div class="option-group">
                        <label for="contentWrapperClass">内容容器CSS类名（仅片段模式）</label>
                        <input type="text" id="contentWrapperClass" value="article-content" placeholder="例如: article-content">
                        <small>HTML片段将包裹在此class的div中</small>
                    </div>
                </div>
            </div>

            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <button class="convert-btn" id="convertBtn" disabled>开始转换</button>

            <div class="info-box">
                <h4>💡 使用说明：</h4>
                <ul>
                    <li><strong>完整HTML文件：</strong>包含完整的HTML结构，可直接在浏览器打开</li>
                    <li><strong>HTML片段：</strong>仅包含内容部分，可以直接插入到您的网站模板中</li>
                    <li><strong>图片标题：</strong>每张图片下方会生成一个可编辑的文本框，用斜体显示</li>
                    <li><strong>图片环绕：</strong>图片设置为左浮动，文字自动环绕</li>
                    <li><strong>下载：</strong>转换完成后自动打包为ZIP文件下载</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const convertBtn = document.getElementById('convertBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');

        let selectedFiles = [];

        uploadZone.addEventListener('click', () => fileInput.click());

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            selectedFiles = Array.from(files).filter(file => 
                file.name.toLowerCase().endsWith('.docx')
            );
            
            displayFiles();
            convertBtn.disabled = selectedFiles.length === 0;
        }

        function displayFiles() {
            fileList.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `
                    <span class="file-name">${file.name}</span>
                    <span class="file-status" id="status-${index}">待转换</span>
                `;
                fileList.appendChild(div);
            });
        }

        convertBtn.addEventListener('click', async () => {
            convertBtn.disabled = true;
            progressBar.style.display = 'block';
            
            const outputFormat = document.querySelector('input[name="outputFormat"]:checked').value;
            const imgCaptionClass = document.getElementById('imgCaptionClass').value || 'img-caption';
            const contentWrapperClass = document.getElementById('contentWrapperClass').value || 'article-content';
            
            const zip = new JSZip();
            let completed = 0;
            let imageCounter = 0;

            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                const statusEl = document.getElementById(`status-${i}`);
                
                try {
                    statusEl.textContent = '转换中...';
                    statusEl.className = 'file-status';
                    
                    const arrayBuffer = await file.arrayBuffer();
                    imageCounter = 0;
                    
                    const options = {
                        convertImage: mammoth.images.imgElement(function(image) {
                            return image.read("base64").then(function(imageBuffer) {
                                const imgNum = ++imageCounter;
                                return {
                                    src: "data:" + image.contentType + ";base64," + imageBuffer
                                };
                            });
                        }),
                        styleMap: [
                            "p[style-name='Heading 1'] => h1:fresh",
                            "p[style-name='Heading 2'] => h2:fresh",
                            "p[style-name='Heading 3'] => h3:fresh"
                        ]
                    };
                    
                    const result = await mammoth.convertToHtml({arrayBuffer: arrayBuffer}, options);
                    let htmlContent = result.value;
                    
                    htmlContent = htmlContent.replace(/<img([^>]*)>/g, function(match, attrs) {
                        const imgNum = attrs.match(/data-img-num="(\d+)"/);
                        const num = imgNum ? imgNum[1] : '';
                        return `<div class="img-wrapper">
    <img${attrs}>
    <p class="${imgCaptionClass}" contenteditable="true">在此输入图片标题...</p>
</div>`;
                    });
                    
                    let finalHtml;
                    
                    if (outputFormat === 'fragment') {
                        finalHtml = `<div class="${contentWrapperClass}">
${htmlContent}
</div>

<!-- 建议的CSS样式，请添加到您的模板中 -->
<!--
<style>
.${contentWrapperClass} {
    line-height: 1.8;
    color: #333;
}

.${contentWrapperClass} .img-wrapper {
    float: left;
    margin: 0 20px 20px 0;
    max-width: 450px;
}

.${contentWrapperClass} .img-wrapper img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
}

.${contentWrapperClass} .${imgCaptionClass} {
    margin-top: 8px;
    font-size: 14px;
    color: #666;
    font-style: italic;
    text-align: center;
    line-height: 1.4;
}

.${contentWrapperClass} p {
    margin: 12px 0;
    text-align: justify;
}

.${contentWrapperClass} h1,
.${contentWrapperClass} h2,
.${contentWrapperClass} h3 {
    clear: both;
    margin-top: 30px;
    margin-bottom: 15px;
    color: #222;
}

.${contentWrapperClass}::after {
    content: "";
    display: table;
    clear: both;
}
</style>
-->`;
                    } else {
                        finalHtml = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${file.name.replace('.docx', '')}</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            line-height: 1.8;
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            background: #f5f5f5;
            color: #333;
        }

        .content {
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .img-wrapper {
            float: left;
            margin: 0 20px 20px 0;
            max-width: 450px;
        }

        .img-wrapper img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .${imgCaptionClass} {
            margin-top: 8px;
            font-size: 14px;
            color: #666;
            font-style: italic;
            text-align: center;
            line-height: 1.4;
            padding: 5px;
            border: 1px dashed transparent;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .${imgCaptionClass}:focus {
            outline: none;
            border-color: #667eea;
            background: #f8f9ff;
        }

        .${imgCaptionClass}:empty::before {
            content: "在此输入图片标题...";
            color: #999;
        }

        p {
            margin: 12px 0;
            text-align: justify;
        }

        h1, h2, h3 {
            clear: both;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #222;
        }

        h1 {
            font-size: 28px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 24px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }

        h3 {
            font-size: 20px;
        }

        .content::after {
            content: "";
            display: table;
            clear: both;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
                margin: 20px auto;
            }

            .content {
                padding: 25px;
            }

            .img-wrapper {
                float: none;
                max-width: 100%;
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>
    <div class="content">
${htmlContent}
    </div>
</body>
</html>`;
                    }
                    
                    const fileName = file.name.replace('.docx', '.html');
                    zip.file(fileName, finalHtml);
                    
                    statusEl.textContent = '✓ 完成';
                    statusEl.className = 'file-status success';
                } catch (error) {
                    statusEl.textContent = '✗ 失败';
                    statusEl.className = 'file-status error';
                    console.error('转换失败:', error);
                }
                
                completed++;
                progressFill.style.width = (completed / selectedFiles.length * 100) + '%';
            }
            
            const zipBlob = await zip.generateAsync({type: 'blob'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(zipBlob);
            link.download = 'converted_html_files.zip';
            link.click();
            
            setTimeout(() => {
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                convertBtn.disabled = false;
                alert('转换完成！HTML文件已打包下载。');
            }, 500);
        });
    </script>
</body>
</html>