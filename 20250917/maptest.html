<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¢ç´¢åœ°å›¾ - è°ƒè¯•ç‰ˆ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./CSS/styles.css">
  <link rel="stylesheet" href="./CSS/Mainstyle.css">
  <link rel="stylesheet" href="./CSS/banner.css"> 
  <link rel="stylesheet" href="./CSS/Menu.css">
  <style>
    .map-container {
      position: relative;
      width: 100%;
      max-width: 100%;
    }
    .map-container img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* å¯ç‚¹å‡»åŒºåŸŸæ ‡è®°æ ·å¼ */
    .clickable-marker {
      position: absolute;
      border: 3px solid #3b82f6;
      border-radius: 50%;
      background-color: rgba(59, 130, 246, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      pointer-events: auto;
      animation: pulse 2s infinite;
      z-index: 10;
    }

    .clickable-marker:hover {
      background-color: rgba(59, 130, 246, 0.4);
      border-color: #2563eb;
      transform: scale(1.1);
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
      }
    }

    .marker-tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      pointer-events: none;
      z-index: 1000;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .marker-tooltip.show {
      opacity: 1;
    }

    .map-legend {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }

    .map-legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #333;
    }

    .map-legend-icon {
      width: 20px;
      height: 20px;
      border: 2px solid #3b82f6;
      border-radius: 50%;
      background-color: rgba(59, 130, 246, 0.2);
    }

    /* è°ƒè¯•ä¿¡æ¯é¢æ¿ */
    .debug-panel {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: rgba(0, 0, 0, 0.9);
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      max-height: 300px;
      overflow-y: auto;
    }

    .debug-panel h3 {
      color: #ff0;
      margin-bottom: 10px;
    }

    .debug-panel .debug-item {
      margin: 5px 0;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
  </style>
</head>

<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="container">
      <div>
        <img src="./Picture/logo.png" alt="å›¾ç‰‡" width="200">
      </div>
      <div>
        <img src="./Picture/Word.png" alt="æ–‡å­—">
      </div>
    </div>
  </nav>

  <!-- ä¸»å¯¼èˆªæ  -->
  <nav class="main-navigation">
    <div class="container">
      <ul class="nav-menu">
        <li><a href="./main.html" target="_blank">é¦–é¡µ</a></li>
        <li><a href="./map.html" class="active" target="_blank">æ¢ç´¢åœ°å›¾</a></li>
        <li><a href="#">æ•…äº‹é•¿å»Š</a></li>
        <li><a href="#">é“è·¯æ¦‚å†µ</a></li>
        <li><a href="#">å…³äºæˆ‘ä»¬</a></li>
      </ul>
    </div>
  </nav>

  <!-- åœ°å›¾å®¹å™¨ -->
  <div class="map-container">
    <img src="./Picture/Map.jpg" usemap="#image-map" alt="åœ°å›¾" id="mainMap" />
    
    <map name="image-map">
      <area target="_blank" alt="" title="" href="./TrainMap/Place1.html" coords="3386,2091,61" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place2.html" coords="3542,787,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place3.html" coords="3029,1371,40" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place4.html" coords="3210,2356,42" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place5.html" coords="3016,1687,39" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place6.html" coords="3075,2253,80" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place7.html" coords="2949,2775,58" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place8.html" coords="2873,1731,69" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place9.html" coords="2928,1546,62" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place10.html" coords="2090,1676,124" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place11.html" coords="3121,1685,51" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place12.html" coords="3071,1571,65" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place13.html" coords="3033,1264,52" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place14.html" coords="3231,2064,66" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place15.html" coords="2932,2442,51" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place16.html" coords="3050,2438,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place17.html" coords="3673,806,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place18.html" coords="2848,1853,66" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place19.html" coords="3792,857,42" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place20.html" coords="3594,990,55" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place21.html" coords="2919,1428,55" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place22.html" coords="2923,2127,60" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place23.html" coords="3029,2080,55" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place25.html" coords="3479,970,68" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place26.html" coords="3698,999,52" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place27.html" coords="3661,1084,60" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place24.html" coords="2799,1566,57" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place28.html" coords="2666,1849,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place29.html" coords="2237,2177,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place30.html" coords="2860,2350,56" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place31.html" coords="2658,2430,60" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place32.html" coords="2385,2257,79" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place33.html" coords="2528,2451,69" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place34.html" coords="3117,1437,69" shape="circle">
    </map>
  </div>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="container">
      <div class="footer-top">
        <div class="footer-column">
          <h4>å¿«é€Ÿé“¾æ¥</h4>
          <ul>
            <li><a href="https://www.nra.gov.cn" target="_blank">å›½å®¶é“è·¯å±€</a></li>
            <li><a href="https://www.12306.cn/index/" target="_blank">ä¸­å›½é“è·¯12306ç½‘ç«™</a></li>
            <li><a href="https://rczp.china-railway.com.cn" target="_blank">ä¸­å›½é“è·¯äººæ‰æ‹›è˜ç½‘</a></li>
            <li><a href="www.china-railway.com.cn" target="_blank">ä¸­å›½å›½å®¶é“è·¯é›†å›¢æœ‰é™å…¬å¸</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>è”ç³»æˆ‘ä»¬</h4>
          <p>âœ‰ï¸ é‚®ç®±:1992113759@qq.com</p>
        </div>
        <div class="footer-column">
          <h4>å…³æ³¨æˆ‘ä»¬</h4>
          <div class="social-links">
            <img src="./Picture/SRcord.png" alt="äºŒç»´ç " width="100">
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- è°ƒè¯•ä¿¡æ¯é¢æ¿ -->
  <div class="debug-panel" id="debugPanel">
    <h3>ğŸ› è°ƒè¯•ä¿¡æ¯ (æŒ‰F12æŸ¥çœ‹è¯¦ç»†æ—¥å¿—)</h3>
    <div id="debugContent">ç­‰å¾…æ‚¬åœæ ‡è®°...</div>
  </div>

  <!-- å›¾åƒæ˜ å°„å“åº”å¼åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/image-map-resizer/1.0.10/js/imageMapResizer.min.js"></script>
  
  <script>
    console.log('========== åœ°å›¾è°ƒè¯•å¼€å§‹ ==========');
    console.log('å½“å‰URL:', window.location.href);
    console.log('é¡µé¢åŠ è½½æ—¶é—´:', new Date().toLocaleString());
    
    // åˆå§‹åŒ–åœ°å›¾æ ‡è®°
    function initializeMapMarkers() {
      const mapContainer = document.querySelector('.map-container');
      const mapImage = document.getElementById('mainMap');
      const areas = document.querySelectorAll('area');
      
      console.log('=== åˆå§‹åŒ–ä¿¡æ¯ ===');
      console.log('å®¹å™¨:', mapContainer);
      console.log('å›¾ç‰‡:', mapImage);
      console.log('åŒºåŸŸæ•°é‡:', areas.length);
      
      // è¾“å‡ºå®¹å™¨çš„CSSå®šä½ä¿¡æ¯
      const containerStyle = window.getComputedStyle(mapContainer);
      console.log('å®¹å™¨å®šä½æ–¹å¼:', containerStyle.position);
      console.log('å®¹å™¨transform:', containerStyle.transform);
      
      if (!mapImage || areas.length === 0) return;

      // åˆ›å»ºå›¾ä¾‹
      createMapLegend(mapContainer);

      // ç­‰å¾…å›¾ç‰‡å®Œå…¨åŠ è½½
      if (mapImage.complete) {
        console.log('å›¾ç‰‡å·²åŠ è½½å®Œæˆ');
        createAllMarkers();
      } else {
        mapImage.addEventListener('load', function() {
          console.log('å›¾ç‰‡åŠ è½½å®Œæˆäº‹ä»¶è§¦å‘');
          createAllMarkers();
        });
      }

      function createAllMarkers() {
        console.log('=== å¼€å§‹åˆ›å»ºæ ‡è®° ===');
        areas.forEach((area, index) => {
          createMarker(area, mapImage, mapContainer, index);
        });
        console.log('æ‰€æœ‰æ ‡è®°åˆ›å»ºå®Œæˆ');
      }

      // ç›‘å¬çª—å£å¤§å°å˜åŒ–
      let resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
          console.log('çª—å£å¤§å°æ”¹å˜ï¼Œæ›´æ–°æ ‡è®°ä½ç½®');
          updateMarkerPositions(mapImage);
        }, 250);
      });
      
      // åˆå§‹åŒ–å“åº”å¼å›¾åƒæ˜ å°„
      if (typeof imageMapResize === 'function') {
        imageMapResize();
        console.log('imageMapResize å·²è°ƒç”¨');
      }
    }

    // åˆ›å»ºå•ä¸ªæ ‡è®°
    function createMarker(area, mapImage, container, index) {
      const shape = area.getAttribute('shape');
      const coords = area.getAttribute('coords').split(',').map(Number);
      
      if (shape === 'circle') {
        const marker = document.createElement('div');
        marker.className = 'clickable-marker';
        marker.dataset.index = index;
        marker.dataset.centerX = coords[0];
        marker.dataset.centerY = coords[1];
        marker.dataset.radius = coords[2];
        
        updateMarkerStyle(marker, mapImage);
        
        marker.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('ç‚¹å‡»æ ‡è®°:', area.href);
          window.open(area.href, area.target || '_blank');
        });
        
        marker.addEventListener('mouseenter', function(e) {
          console.log('\n========== æ‚¬åœäº‹ä»¶è§¦å‘ ==========');
          console.log('æ ‡è®°ç´¢å¼•:', index);
          showTooltip(e, area, container, marker);
        });
        
        marker.addEventListener('mouseleave', function() {
          hideTooltip(container);
        });
        
        container.appendChild(marker);
      }
    }

    // æ›´æ–°æ ‡è®°æ ·å¼å’Œä½ç½®
    function updateMarkerStyle(marker, mapImage) {
      const imgWidth = mapImage.offsetWidth;
      const imgHeight = mapImage.offsetHeight;
      const naturalWidth = mapImage.naturalWidth;
      const naturalHeight = mapImage.naturalHeight;
      
      const scaleX = imgWidth / naturalWidth;
      const scaleY = imgHeight / naturalHeight;
      
      const centerX = parseFloat(marker.dataset.centerX);
      const centerY = parseFloat(marker.dataset.centerY);
      const radius = parseFloat(marker.dataset.radius);
      
      const scaledX = centerX * scaleX;
      const scaledY = centerY * scaleY;
      const scaledRadius = radius * Math.min(scaleX, scaleY);
      
      marker.style.left = (scaledX - scaledRadius) + 'px';
      marker.style.top = (scaledY - scaledRadius) + 'px';
      marker.style.width = (scaledRadius * 2) + 'px';
      marker.style.height = (scaledRadius * 2) + 'px';
    }

    // æ›´æ–°æ‰€æœ‰æ ‡è®°ä½ç½®
    function updateMarkerPositions(mapImage) {
      const markers = document.querySelectorAll('.clickable-marker');
      markers.forEach(marker => {
        updateMarkerStyle(marker, mapImage);
      });
    }

    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
    function showTooltip(event, area, container, marker) {
      console.log('=== æ˜¾ç¤ºæç¤ºæ¡† ===');
      
      let tooltip = container.querySelector('.marker-tooltip');
      
      if (!tooltip) {
        tooltip = document.createElement('div');
        tooltip.className = 'marker-tooltip';
        container.appendChild(tooltip);
        console.log('åˆ›å»ºæ–°çš„tooltipå…ƒç´ ');
      }
      
      const href = area.href;
      const match = href.match(/Place(\d+)\.html/);
      const placeNumber = match ? match[1] : 'æœªçŸ¥';
      
      tooltip.textContent = `åœ°ç‚¹ ${placeNumber} - ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…`;
      
      // è·å–å„ç§ä½ç½®ä¿¡æ¯
      const markerRect = marker.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();
      const containerStyle = window.getComputedStyle(container);
      
      // è®¡ç®—ç›¸å¯¹ä½ç½®
      const relativeLeft = markerRect.left - containerRect.left;
      const relativeTop = markerRect.top - containerRect.top;
      
      // æ–¹æ³•1: ä½¿ç”¨markerç›¸å¯¹ä½ç½®
      const method1Left = relativeLeft + markerRect.width / 2 + 10;
      const method1Top = relativeTop - 10;
      
      // æ–¹æ³•2: ç›´æ¥ä½¿ç”¨markerçš„styleå±æ€§
      const markerLeft = parseFloat(marker.style.left);
      const markerTop = parseFloat(marker.style.top);
      const markerWidth = parseFloat(marker.style.width);
      const method2Left = markerLeft + markerWidth / 2 + 10;
      const method2Top = markerTop - 10;
      
      // æ–¹æ³•3: ä½¿ç”¨é¼ æ ‡ä½ç½®
      const method3Left = event.clientX - containerRect.left + 15;
      const method3Top = event.clientY - containerRect.top - 30;
      
      console.log('--- é¼ æ ‡äº‹ä»¶ä¿¡æ¯ ---');
      console.log('clientX:', event.clientX);
      console.log('clientY:', event.clientY);
      console.log('pageX:', event.pageX);
      console.log('pageY:', event.pageY);
      
      console.log('--- Markerä¿¡æ¯ ---');
      console.log('markerRect:', {
        left: markerRect.left,
        top: markerRect.top,
        width: markerRect.width,
        height: markerRect.height
      });
      console.log('marker.style.left:', marker.style.left);
      console.log('marker.style.top:', marker.style.top);
      console.log('marker.style.width:', marker.style.width);
      
      console.log('--- Containerä¿¡æ¯ ---');
      console.log('containerRect:', {
        left: containerRect.left,
        top: containerRect.top,
        width: containerRect.width,
        height: containerRect.height
      });
      console.log('container.position:', containerStyle.position);
      console.log('container.transform:', containerStyle.transform);
      console.log('container.offsetLeft:', container.offsetLeft);
      console.log('container.offsetTop:', container.offsetTop);
      
      console.log('--- é¡µé¢æ»šåŠ¨ä¿¡æ¯ ---');
      console.log('window.scrollX:', window.scrollX);
      console.log('window.scrollY:', window.scrollY);
      console.log('window.pageXOffset:', window.pageXOffset);
      console.log('window.pageYOffset:', window.pageYOffset);
      
      console.log('--- ä¸‰ç§è®¡ç®—æ–¹æ³•çš„ç»“æœ ---');
      console.log('æ–¹æ³•1 (markerç›¸å¯¹ä½ç½®):', { left: method1Left, top: method1Top });
      console.log('æ–¹æ³•2 (marker style):', { left: method2Left, top: method2Top });
      console.log('æ–¹æ³•3 (é¼ æ ‡ä½ç½®):', { left: method3Left, top: method3Top });
      
      console.log('--- ç›¸å¯¹ä½ç½®è®¡ç®— ---');
      console.log('relativeLeft:', relativeLeft);
      console.log('relativeTop:', relativeTop);
      
      // é»˜è®¤ä½¿ç”¨æ–¹æ³•2
      tooltip.style.left = method2Left + 'px';
      tooltip.style.top = method2Top + 'px';
      
      console.log('=== æœ€ç»ˆè®¾ç½®çš„tooltipä½ç½® ===');
      console.log('tooltip.style.left:', tooltip.style.left);
      console.log('tooltip.style.top:', tooltip.style.top);
      
      // æ›´æ–°è°ƒè¯•é¢æ¿
      updateDebugPanel({
        placeNumber,
        method1: { left: method1Left.toFixed(2), top: method1Top.toFixed(2) },
        method2: { left: method2Left.toFixed(2), top: method2Top.toFixed(2) },
        method3: { left: method3Left.toFixed(2), top: method3Top.toFixed(2) },
        containerPos: containerStyle.position,
        scrollY: window.scrollY.toFixed(2)
      });
      
      setTimeout(() => {
        tooltip.classList.add('show');
      }, 10);
    }

    // éšè—æç¤ºä¿¡æ¯
    function hideTooltip(container) {
      const tooltip = container.querySelector('.marker-tooltip');
      if (tooltip) {
        tooltip.classList.remove('show');
      }
    }

    // åˆ›å»ºåœ°å›¾å›¾ä¾‹
    function createMapLegend(container) {
      const legend = document.createElement('div');
      legend.className = 'map-legend';
      legend.innerHTML = `
        <div class="map-legend-item">
          <div class="map-legend-icon"></div>
          <span>å¯ç‚¹å‡»åŒºåŸŸ</span>
        </div>
      `;
      container.appendChild(legend);
    }

    // æ›´æ–°è°ƒè¯•é¢æ¿
    function updateDebugPanel(data) {
      const debugContent = document.getElementById('debugContent');
      debugContent.innerHTML = `
        <div class="debug-item"><strong>åœ°ç‚¹:</strong> ${data.placeNumber}</div>
        <div class="debug-item"><strong>æ–¹æ³•1:</strong> left=${data.method1.left}, top=${data.method1.top}</div>
        <div class="debug-item"><strong>æ–¹æ³•2:</strong> left=${data.method2.left}, top=${data.method2.top}</div>
        <div class="debug-item"><strong>æ–¹æ³•3:</strong> left=${data.method3.left}, top=${data.method3.top}</div>
        <div class="debug-item"><strong>å®¹å™¨å®šä½:</strong> ${data.containerPos}</div>
        <div class="debug-item"><strong>é¡µé¢æ»šåŠ¨:</strong> ${data.scrollY}px</div>
      `;
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeMapMarkers);
    } else {
      initializeMapMarkers();
    }
    
    console.log('========== è„šæœ¬åŠ è½½å®Œæˆ ==========');
  </script>
</body>
</html>