<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>探索地图 - 调试版</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./CSS/styles.css">
  <link rel="stylesheet" href="./CSS/Mainstyle.css">
  <link rel="stylesheet" href="./CSS/banner.css"> 
  <link rel="stylesheet" href="./CSS/Menu.css">
  <style>
    .map-container {
      position: relative;
      width: 100%;
      max-width: 100%;
    }
    .map-container img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* 可点击区域标记样式 */
    .clickable-marker {
      position: absolute;
      border: 3px solid #3b82f6;
      border-radius: 50%;
      background-color: rgba(59, 130, 246, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      pointer-events: auto;
      animation: pulse 2s infinite;
      z-index: 10;
    }

    .clickable-marker:hover {
      background-color: rgba(59, 130, 246, 0.4);
      border-color: #2563eb;
      transform: scale(1.1);
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }
      50% {
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
      }
    }

    .marker-tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      pointer-events: none;
      z-index: 1000;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .marker-tooltip.show {
      opacity: 1;
    }

    .map-legend {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }

    .map-legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #333;
    }

    .map-legend-icon {
      width: 20px;
      height: 20px;
      border: 2px solid #3b82f6;
      border-radius: 50%;
      background-color: rgba(59, 130, 246, 0.2);
    }

    /* 调试信息面板 */
    .debug-panel {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background-color: rgba(0, 0, 0, 0.9);
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      max-height: 300px;
      overflow-y: auto;
    }

    .debug-panel h3 {
      color: #ff0;
      margin-bottom: 10px;
    }

    .debug-panel .debug-item {
      margin: 5px 0;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
  </style>
</head>

<body>
  <!-- 顶部导航栏 -->
  <nav class="navbar">
    <div class="container">
      <div>
        <img src="./Picture/logo.png" alt="图片" width="200">
      </div>
      <div>
        <img src="./Picture/Word.png" alt="文字">
      </div>
    </div>
  </nav>

  <!-- 主导航栏 -->
  <nav class="main-navigation">
    <div class="container">
      <ul class="nav-menu">
        <li><a href="./main.html" target="_blank">首页</a></li>
        <li><a href="./map.html" class="active" target="_blank">探索地图</a></li>
        <li><a href="#">故事长廊</a></li>
        <li><a href="#">铁路概况</a></li>
        <li><a href="#">关于我们</a></li>
      </ul>
    </div>
  </nav>

  <!-- 地图容器 -->
  <div class="map-container">
    <img src="./Picture/Map.jpg" usemap="#image-map" alt="地图" id="mainMap" />
    
    <map name="image-map">
      <area target="_blank" alt="" title="" href="./TrainMap/Place1.html" coords="3386,2091,61" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place2.html" coords="3542,787,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place3.html" coords="3029,1371,40" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place4.html" coords="3210,2356,42" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place5.html" coords="3016,1687,39" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place6.html" coords="3075,2253,80" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place7.html" coords="2949,2775,58" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place8.html" coords="2873,1731,69" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place9.html" coords="2928,1546,62" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place10.html" coords="2090,1676,124" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place11.html" coords="3121,1685,51" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place12.html" coords="3071,1571,65" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place13.html" coords="3033,1264,52" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place14.html" coords="3231,2064,66" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place15.html" coords="2932,2442,51" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place16.html" coords="3050,2438,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place17.html" coords="3673,806,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place18.html" coords="2848,1853,66" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place19.html" coords="3792,857,42" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place20.html" coords="3594,990,55" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place21.html" coords="2919,1428,55" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place22.html" coords="2923,2127,60" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place23.html" coords="3029,2080,55" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place25.html" coords="3479,970,68" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place26.html" coords="3698,999,52" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place27.html" coords="3661,1084,60" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place24.html" coords="2799,1566,57" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place28.html" coords="2666,1849,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place29.html" coords="2237,2177,64" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place30.html" coords="2860,2350,56" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place31.html" coords="2658,2430,60" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place32.html" coords="2385,2257,79" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place33.html" coords="2528,2451,69" shape="circle">
      <area target="_blank" alt="" title="" href="./TrainMap/Place34.html" coords="3117,1437,69" shape="circle">
    </map>
  </div>

  <!-- 页脚 -->
  <footer class="footer">
    <div class="container">
      <div class="footer-top">
        <div class="footer-column">
          <h4>快速链接</h4>
          <ul>
            <li><a href="https://www.nra.gov.cn" target="_blank">国家铁路局</a></li>
            <li><a href="https://www.12306.cn/index/" target="_blank">中国铁路12306网站</a></li>
            <li><a href="https://rczp.china-railway.com.cn" target="_blank">中国铁路人才招聘网</a></li>
            <li><a href="www.china-railway.com.cn" target="_blank">中国国家铁路集团有限公司</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>联系我们</h4>
          <p>✉️ 邮箱:1992113759@qq.com</p>
        </div>
        <div class="footer-column">
          <h4>关注我们</h4>
          <div class="social-links">
            <img src="./Picture/SRcord.png" alt="二维码" width="100">
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- 调试信息面板 -->
  <div class="debug-panel" id="debugPanel">
    <h3>🐛 调试信息 (按F12查看详细日志)</h3>
    <div id="debugContent">等待悬停标记...</div>
  </div>

  <!-- 图像映射响应式库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/image-map-resizer/1.0.10/js/imageMapResizer.min.js"></script>
  
  <script>
    console.log('========== 地图调试开始 ==========');
    console.log('当前URL:', window.location.href);
    console.log('页面加载时间:', new Date().toLocaleString());
    
    // 初始化地图标记
    function initializeMapMarkers() {
      const mapContainer = document.querySelector('.map-container');
      const mapImage = document.getElementById('mainMap');
      const areas = document.querySelectorAll('area');
      
      console.log('=== 初始化信息 ===');
      console.log('容器:', mapContainer);
      console.log('图片:', mapImage);
      console.log('区域数量:', areas.length);
      
      // 输出容器的CSS定位信息
      const containerStyle = window.getComputedStyle(mapContainer);
      console.log('容器定位方式:', containerStyle.position);
      console.log('容器transform:', containerStyle.transform);
      
      if (!mapImage || areas.length === 0) return;

      // 创建图例
      createMapLegend(mapContainer);

      // 等待图片完全加载
      if (mapImage.complete) {
        console.log('图片已加载完成');
        createAllMarkers();
      } else {
        mapImage.addEventListener('load', function() {
          console.log('图片加载完成事件触发');
          createAllMarkers();
        });
      }

      function createAllMarkers() {
        console.log('=== 开始创建标记 ===');
        areas.forEach((area, index) => {
          createMarker(area, mapImage, mapContainer, index);
        });
        console.log('所有标记创建完成');
      }

      // 监听窗口大小变化
      let resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
          console.log('窗口大小改变，更新标记位置');
          updateMarkerPositions(mapImage);
        }, 250);
      });
      
      // 初始化响应式图像映射
      if (typeof imageMapResize === 'function') {
        imageMapResize();
        console.log('imageMapResize 已调用');
      }
    }

    // 创建单个标记
    function createMarker(area, mapImage, container, index) {
      const shape = area.getAttribute('shape');
      const coords = area.getAttribute('coords').split(',').map(Number);
      
      if (shape === 'circle') {
        const marker = document.createElement('div');
        marker.className = 'clickable-marker';
        marker.dataset.index = index;
        marker.dataset.centerX = coords[0];
        marker.dataset.centerY = coords[1];
        marker.dataset.radius = coords[2];
        
        updateMarkerStyle(marker, mapImage);
        
        marker.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('点击标记:', area.href);
          window.open(area.href, area.target || '_blank');
        });
        
        marker.addEventListener('mouseenter', function(e) {
          console.log('\n========== 悬停事件触发 ==========');
          console.log('标记索引:', index);
          showTooltip(e, area, container, marker);
        });
        
        marker.addEventListener('mouseleave', function() {
          hideTooltip(container);
        });
        
        container.appendChild(marker);
      }
    }

    // 更新标记样式和位置
    function updateMarkerStyle(marker, mapImage) {
      const imgWidth = mapImage.offsetWidth;
      const imgHeight = mapImage.offsetHeight;
      const naturalWidth = mapImage.naturalWidth;
      const naturalHeight = mapImage.naturalHeight;
      
      const scaleX = imgWidth / naturalWidth;
      const scaleY = imgHeight / naturalHeight;
      
      const centerX = parseFloat(marker.dataset.centerX);
      const centerY = parseFloat(marker.dataset.centerY);
      const radius = parseFloat(marker.dataset.radius);
      
      const scaledX = centerX * scaleX;
      const scaledY = centerY * scaleY;
      const scaledRadius = radius * Math.min(scaleX, scaleY);
      
      marker.style.left = (scaledX - scaledRadius) + 'px';
      marker.style.top = (scaledY - scaledRadius) + 'px';
      marker.style.width = (scaledRadius * 2) + 'px';
      marker.style.height = (scaledRadius * 2) + 'px';
    }

    // 更新所有标记位置
    function updateMarkerPositions(mapImage) {
      const markers = document.querySelectorAll('.clickable-marker');
      markers.forEach(marker => {
        updateMarkerStyle(marker, mapImage);
      });
    }

    // 显示提示信息
    function showTooltip(event, area, container, marker) {
      console.log('=== 显示提示框 ===');
      
      let tooltip = container.querySelector('.marker-tooltip');
      
      if (!tooltip) {
        tooltip = document.createElement('div');
        tooltip.className = 'marker-tooltip';
        container.appendChild(tooltip);
        console.log('创建新的tooltip元素');
      }
      
      const href = area.href;
      const match = href.match(/Place(\d+)\.html/);
      const placeNumber = match ? match[1] : '未知';
      
      tooltip.textContent = `地点 ${placeNumber} - 点击查看详情`;
      
      // 获取各种位置信息
      const markerRect = marker.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();
      const containerStyle = window.getComputedStyle(container);
      
      // 计算相对位置
      const relativeLeft = markerRect.left - containerRect.left;
      const relativeTop = markerRect.top - containerRect.top;
      
      // 方法1: 使用marker相对位置
      const method1Left = relativeLeft + markerRect.width / 2 + 10;
      const method1Top = relativeTop - 10;
      
      // 方法2: 直接使用marker的style属性
      const markerLeft = parseFloat(marker.style.left);
      const markerTop = parseFloat(marker.style.top);
      const markerWidth = parseFloat(marker.style.width);
      const method2Left = markerLeft + markerWidth / 2 + 10;
      const method2Top = markerTop - 10;
      
      // 方法3: 使用鼠标位置
      const method3Left = event.clientX - containerRect.left + 15;
      const method3Top = event.clientY - containerRect.top - 30;
      
      console.log('--- 鼠标事件信息 ---');
      console.log('clientX:', event.clientX);
      console.log('clientY:', event.clientY);
      console.log('pageX:', event.pageX);
      console.log('pageY:', event.pageY);
      
      console.log('--- Marker信息 ---');
      console.log('markerRect:', {
        left: markerRect.left,
        top: markerRect.top,
        width: markerRect.width,
        height: markerRect.height
      });
      console.log('marker.style.left:', marker.style.left);
      console.log('marker.style.top:', marker.style.top);
      console.log('marker.style.width:', marker.style.width);
      
      console.log('--- Container信息 ---');
      console.log('containerRect:', {
        left: containerRect.left,
        top: containerRect.top,
        width: containerRect.width,
        height: containerRect.height
      });
      console.log('container.position:', containerStyle.position);
      console.log('container.transform:', containerStyle.transform);
      console.log('container.offsetLeft:', container.offsetLeft);
      console.log('container.offsetTop:', container.offsetTop);
      
      console.log('--- 页面滚动信息 ---');
      console.log('window.scrollX:', window.scrollX);
      console.log('window.scrollY:', window.scrollY);
      console.log('window.pageXOffset:', window.pageXOffset);
      console.log('window.pageYOffset:', window.pageYOffset);
      
      console.log('--- 三种计算方法的结果 ---');
      console.log('方法1 (marker相对位置):', { left: method1Left, top: method1Top });
      console.log('方法2 (marker style):', { left: method2Left, top: method2Top });
      console.log('方法3 (鼠标位置):', { left: method3Left, top: method3Top });
      
      console.log('--- 相对位置计算 ---');
      console.log('relativeLeft:', relativeLeft);
      console.log('relativeTop:', relativeTop);
      
      // 默认使用方法2
      tooltip.style.left = method2Left + 'px';
      tooltip.style.top = method2Top + 'px';
      
      console.log('=== 最终设置的tooltip位置 ===');
      console.log('tooltip.style.left:', tooltip.style.left);
      console.log('tooltip.style.top:', tooltip.style.top);
      
      // 更新调试面板
      updateDebugPanel({
        placeNumber,
        method1: { left: method1Left.toFixed(2), top: method1Top.toFixed(2) },
        method2: { left: method2Left.toFixed(2), top: method2Top.toFixed(2) },
        method3: { left: method3Left.toFixed(2), top: method3Top.toFixed(2) },
        containerPos: containerStyle.position,
        scrollY: window.scrollY.toFixed(2)
      });
      
      setTimeout(() => {
        tooltip.classList.add('show');
      }, 10);
    }

    // 隐藏提示信息
    function hideTooltip(container) {
      const tooltip = container.querySelector('.marker-tooltip');
      if (tooltip) {
        tooltip.classList.remove('show');
      }
    }

    // 创建地图图例
    function createMapLegend(container) {
      const legend = document.createElement('div');
      legend.className = 'map-legend';
      legend.innerHTML = `
        <div class="map-legend-item">
          <div class="map-legend-icon"></div>
          <span>可点击区域</span>
        </div>
      `;
      container.appendChild(legend);
    }

    // 更新调试面板
    function updateDebugPanel(data) {
      const debugContent = document.getElementById('debugContent');
      debugContent.innerHTML = `
        <div class="debug-item"><strong>地点:</strong> ${data.placeNumber}</div>
        <div class="debug-item"><strong>方法1:</strong> left=${data.method1.left}, top=${data.method1.top}</div>
        <div class="debug-item"><strong>方法2:</strong> left=${data.method2.left}, top=${data.method2.top}</div>
        <div class="debug-item"><strong>方法3:</strong> left=${data.method3.left}, top=${data.method3.top}</div>
        <div class="debug-item"><strong>容器定位:</strong> ${data.containerPos}</div>
        <div class="debug-item"><strong>页面滚动:</strong> ${data.scrollY}px</div>
      `;
    }

    // 页面加载完成后初始化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeMapMarkers);
    } else {
      initializeMapMarkers();
    }
    
    console.log('========== 脚本加载完成 ==========');
  </script>
</body>
</html>